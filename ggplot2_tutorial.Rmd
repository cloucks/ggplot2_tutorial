#ggplot_tutorial

 - **Authors**: Catrina Loucks
 - **Research field**: Genetics
 - **Lesson Topic**: In this lesson we will be using ggplot2 to create plots that are beautiful, flexible and reproducible

###Motivation
- In my research I am interested in how worms with different genetic defects respond to sensory stimuli
 - Today we will be working with data from my research looking at how different worm mutants respond to repeated mechanical stimuli (taps)
 - Worms reverse when subjected to a tap, but will learn to ignore taps and reverse less

First make sure you have ggplot2 

```{r-get_ggplot2}

#make sure ggplot2 is installed
if(!require("ggplot2")) {
    install.packages("ggplot2")
    library(ggplot2)
  } 

```

#####Then load the data
 - These data compare a mutant strain to wild-type animals 
 - Each strain is subjected to repeated taps (30 in total) and reversals are recorded at each tap
 - All worms are expected to respond similarly to the first tap (most responding), but some mutants learn faster or slower to ignore the tap stimuli
 
```{r-load_data}

#load and take a look at data
#set working directory to folder containing the data.txt file for this tutorial
setwd("~/Documents/PhD/Programming_study_group/ggplot2_tutorial")
data <- read.table("data_short.txt", header=TRUE)
head(data)

```

Now we want to make a plot with tap_number on the x-axis and reversal on the y-axis
 - ggplot starts with two arguments: data and aesthetic mapping
 
```{r-make_plot}
#assign plot to variable p 
p <- ggplot(data, aes(tap_number, reversal)) #aes is short for aesthetic mapping

```

We need to add layers to the plot to visualize data 
 - a layer can be as simple as specifying a geom 
 - geom is short for geometric object and describes the type of object that is used to display the data 
 
```{r-add_layers}
#you can add layers to the plot with a +
p + geom_point() #geom_point is added to make data a scatterplot

```

You can also manipulate data directly in ggplot2
 - all strains should respond similarly to the first tap, but we see that the two strains start at different points on the y-axis
```{r-manipulate_data}

#look at habituation data
data

#we have a column with reversal, which represents the number of worms reversing, and a column with N, which represents the total number of worms looked at during the tap
#to normalize the data, we need to divide reversal by N, to look at the proportion of worms reversing
#this can be done directly in ggplot2

#manipulate the y-axis to become reversal/N
p <- ggplot(data, aes(tap_number, reversal/N)) + 
  geom_point()

#now both strains show a similar response to the intial tap
```

Now we can play with aesthetics that are visual properties affecting the way observations are displayed (e.g. colour, size and shape)

```{r-adding_aesthetics}

#you can assign categorial variables a colour or shape and continuous variables to size

p  + geom_point(aes(colour=strain)) #use aesthetics to colour points in scatterplot according to strain

p + geom_point(aes(shape=strain)) #different shapes represent the different strains

p + geom_point(aes(colour=tap_number, shape=strain)) #can string two aesthetics together using commas

p + geom_point(aes(colour=tap_number, shape=strain, size=7)) #can also play around with size

```
  
  
Now we can experiment with geoms to get different plots
```{r-varying_geom}

p + geom_point(aes(colour=strain))

p + geom_point(aes(colour=strain)) + #can add other layers with the +
  geom_line()  

p + geom_point(aes(colour=strain)) +
  geom_line(aes(group=strain)) #add group in aesthetics to make lines attach points from the same strain

p + geom_point(aes(colour=strain)) + #adding colour in aesthetics for each strain
  geom_line(aes(colour=strain)) 

```


##Challenge 1

Make a boxplot of strain on x-axis (categorical variable) and N (number of animals assessed) on y-axis to determine how many animals were tested

 - hint: use geom_boxplot

Now we can add error bars to our data
```{r-error_bars}

p + geom_point(aes(colour=strain)) +
  geom_line(aes(colour=strain)) +
  geom_errorbar(aes(ymin=conf_int_lower, ymax=conf_int_upper, colour=strain))

```

Next, we can make labels (title, axes and legend)
```{r-making_labels}

p + geom_point(aes(colour=strain)) +
  geom_line(aes(colour=strain)) +
  geom_errorbar(aes(ymin=conf_int_lower, ymax=conf_int_upper, colour=strain)) +
  ggtitle("Habituation probability") + #add title
  xlab("Tap number") + #add x-label
  ylab("Proportion reversing") + #add y-label
  scale_colour_hue("type of worm", #change legend title
    breaks = c("mutant", "N2"), #determine what strains are on the legend
    labels = c("mutant", "wild-type"))
```

We can also decide what values we want on our axes
```{r-changing_axes}

p + geom_point(aes(colour=strain)) +
  geom_line(aes(colour=strain)) +
  geom_errorbar(aes(ymin=conf_int_lower, ymax=conf_int_upper, colour=strain)) +
  ggtitle("Habituation probability") + #add title
  xlab("Tap number") + #add x-label
  ylab("Proportion reversing") + #add y-label
  scale_colour_hue("type of worm", #change legend title
    breaks = c("mutant", "N2"), #determine what strains are on the legend
    labels = c("mutant", "wild-type")) +
  scale_x_discrete(limits=c(0:30), breaks=c(0,5,10,15,20,25,30)) + #change limits and spacing in x-axis
  scale_y_continuous(limits=c(0.0:1.0), breaks=c(0.0,0.20,0.40,0.60,0.80,1.00)) #change limits and spacing in y-axis

```

Finally we can play around with the style of the graph
```{r-change_style}
p + geom_point(aes(colour=strain)) +
  geom_line(aes(colour=strain)) +
  geom_errorbar(aes(ymin=conf_int_lower, ymax=conf_int_upper, colour=strain)) +
  ggtitle("Habituation probability") + #add title
  xlab("Tap number") + #add x-label
  ylab("Proportion reversing") + #add y-label
  scale_colour_hue("type of worm", #change legend title
    breaks = c("mutant", "N2"), #determine what strains are on the legend
    labels = c("mutant", "wild-type")) +
  scale_x_discrete(limits=c(0:30), breaks=c(0,5,10,15,20,25,30)) + #change limits and spacing in x-axis
  scale_y_continuous(limits=c(0.0:1.0), breaks=c(0.0,0.20,0.40,0.60,0.80,1.00)) + #change limits and spacing in y-axis 
  theme_classic()
```
  

###Answer to challenge 1
```{r-make_boxplot}

ggplot(data, aes(strain, N)) +
  geom_boxplot()

```
